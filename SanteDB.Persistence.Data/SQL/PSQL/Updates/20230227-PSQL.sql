/** 
 * <feature scope="SanteDB.Persistence.Data" id="20230227-01" name="Update:20230227-01" applyRange="1.1.0.0-1.2.0.0"  invariantName="npgsql">
 *	<summary>Update: Migrate Nationality and VIP to person</summary>
 *	<isInstalled>select ck_patch('20230227-01')</isInstalled>
 * </feature>
 */
UPDATE ENT_VRSN_TBL SET CLS_CD_ID = '4d1a5c28-deb7-411e-b75f-d524f90dfa63' WHERE CLS_CD_ID = '8CF4B0B0-84E5-4122-85FE-6AFA8240C218';

INSERT INTO REL_VRFY_SYSTBL (rel_vrfy_id, rel_typ_cd_id, src_cls_cd_id, trg_cls_cd_id, err_desc) 
SELECT uuid_generate_v1(), rel_typ_cd_id, CASE WHEN SRC_CLS_CD_ID = '8CF4B0B0-84E5-4122-85FE-6AFA8240C218' THEN '4d1a5c28-deb7-411e-b75f-d524f90dfa63' ELSE SRC_CLS_CD_ID END,
CASE WHEN TRG_CLS_CD_ID = '8CF4B0B0-84E5-4122-85FE-6AFA8240C218' THEN '4d1a5c28-deb7-411e-b75f-d524f90dfa63' ELSE TRG_CLS_CD_ID END, err_desc
FROM REL_VRFY_SYSTBL
WHERE SRC_CLS_CD_ID = '8CF4B0B0-84E5-4122-85FE-6AFA8240C218' OR TRG_CLS_CD_ID = '8CF4B0B0-84E5-4122-85FE-6AFA8240C218' 
ON CONFLICT DO NOTHING;

DELETE FROM REL_VRFY_SYSTBL WHERE SRC_CLS_CD_ID = '8CF4B0B0-84E5-4122-85FE-6AFA8240C218' OR TRG_CLS_CD_ID = '8CF4B0B0-84E5-4122-85FE-6AFA8240C218' ;

 
SELECT REG_PATCH('20230227-01'); 